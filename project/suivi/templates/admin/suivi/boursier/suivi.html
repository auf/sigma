{% extends "admin/base_site.html" %}
{% load i18n %}

{% block extrahead %}{{ block.super }}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/suivi-boursier.js"></script>
{% endblock %}
{% block breadcrumbs %}{% if not is_popup %}
<div class="breadcrumbs">
     <a href="../../">{% trans "Home" %}</a> &rsaquo;
     <a href="{% url admin:suivi_boursier_changelist %}">Boursiers</a> &rsaquo;
     <a href="{% url admin:suivi_boursier_change boursier.pk %}">{{ boursier }}</a> &rsaquo;
     Suivi
</div>
{% endif %}{% endblock %}

{% block content %}
<div id="content-main">
    {% block object-tools %}{% endblock %}

    <h1>Suivi de {{ boursier }}</h1>
    <h2>Dépenses prévisionnelles</h2>
    <table>
        <thead>
            <tr>
                <th>No</th>
                <th>Date</th>
                <th>Description</th>
                <th align="right">Mont. €</th>
                <th>Impl.</th>
            </tr>
        </thead>
        <tbody>
		{% for ligne in boursier.depensesprevisionnelles.all %}
		<tr>
			<td>{{ ligne.numero|default_if_none:"" }}</td>
			<td><nobr>{{ ligne.date|date:"j N Y" }}</nobr></td>
			<td>{{ ligne.description }}</td>
			<td align="right" char=".">{{ ligne.montant_eur }}</td>
			<td>{{ ligne.get_implantation_display }}</td>
		</tr>
		{% endfor %}
		</tbody>
	</table>
    <h2>Dépenses réelles (CODA)</h2>
    <table>
        <thead>
            <tr>
                <th>Code</th>
                <th>No</th>
                <th>Ex/Pér.</th>
                <th>Date</th>
                <th>Description</th>
                <th align="right">Mont. €</th>
                <th>D/C</th>
                <th>Impl.</th>
                <th>Employé</th>
                <th>Paiement</th>
            </tr>
        </thead>
        {% for groupe in groupes_ecritures %}
        <tbody>
            <tr>
                <th colspan="5">
                    PCG {{ groupe.compte_comptable.code }}: {{ groupe.compte_comptable.nom }}
                </th>
                <th align="right" char="." style="text-align: right">
                  {{ groupe.sous_total }}
                </th>
                <th colspan="4"></th>
            </tr>
            {% for ligne in groupe.lignes %}
            <tr>
                <td>{{ ligne.ecriture.code }}</td>
                <td>{{ ligne.ecriture.numero }}</td>
                <td>{{ ligne.ecriture.annee }}/{{ ligne.ecriture.periode }}</td>
                <td><nobr>{{ ligne.ecriture.date|date:"j N Y" }}</nobr></td>
                <td>{{ ligne.description }}</td>
                {% if ligne.montant_eur < 0 %}
                <td align="right" char="." style="color: red">
                {% else %}
                <td align="right" char=".">
                {% endif %}
                    {{ ligne.montant_eur }}
                </td>
                <td>{{ ligne.get_debit_credit_display }}</td>
                <td>{{ ligne.implantation }}</td>
                <td>{{ ligne.salarie }}</td>
                <td>{{ ligne.get_etat_paiement_display }}</td>
            </tr>
            {% endfor %}
        </tbody>
        {% endfor %}
    </table>
</div>
{% endblock %}
